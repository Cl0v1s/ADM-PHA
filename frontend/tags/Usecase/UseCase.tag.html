<app-usecase>
    <div class="header">
        <div>
            <p>
                { usecase.name }
            </p>
            <p>
                Situation d'utilisation 
            </p>
        </div>
        <div class="picture {usecase.name}"></div>
    </div>
    <div class="tools">
        <div each='{ tool in tools }' data-id='{ tool.id }' onclick='{ choose }'>{ tool.name }</div>
    </div>
    <app-dm if='{ tools.length > 0 }' dm='{ tools[0] }' ref="tool" resident="{ resident }"></app-dm>

    <script>
        var tag = this;
        
        tag.usecase = null;
        tag.tools = null;
        tag.resident = null;

        tag.on("before-mount", function(){
            tag.usecase = tag.opts.usecase;
            if(tag.usecase == null)
                throw new Error("Usecase cant be null.");
            tag.tools = tag.opts.tools;
            if(tag.tools == null)
                throw new Error("Tools cant be null.");
            tag.resident = tag.opts.resident;
            if(tag.resident == null)
                throw new Error("Resident cant be null.");
        });


        tag.choose = function(event)
        {
            let id = event.target.getAttribute("data-id");
            if(id == null)
                return;
            let request = App.request(App.Address+"/tool/"+id, null, "GET");
            request.then(function(response){
                tag.refs.tool.dm = response.value;
                tag.refs.tool.update();
            });
            request.catch(function(error){
                ErrorHandler.alertIfError(error);
            });
        };
    </script>
</app-usecase>